# Output Management Tool - ユーザーガイド

**バージョン**: 2.0.0  
**最終更新**: 2025年12月18日  
**想定読者**: 初めて使うユーザー / 現場メンバー

> 迷ったら「クイックスタート10分」と「よくある操作」から始めてください。

---

## 📖 目次

1. [クイックスタート10分](#クイックスタート10分)
2. [よくある操作フロー](#よくある操作フロー)
3. [画面と用語](#画面と用語)
4. [プロジェクト管理](#プロジェクト管理)
5. [工程管理（CSV/手動）](#工程管理csv手動)
6. [BPMNダイアグラム](#bpmnダイアグラム)
7. [マニュアル管理](#マニュアル管理)
8. [三位一体同期](#三位一体同期)
9. [カスタム列](#カスタム列)
10. [トラブルシューティング](#トラブルシューティング)

---

## クイックスタート10分

1) **プロジェクトを作成する（2分）**  
   - ホーム → 「新規プロジェクト」をクリック → プロジェクト名を入力 → 「作成」。

2) **スイムレーンを準備する（2分）**  
   - プロジェクト詳細 → 「スイムレーン」タブ → 「追加」を押し、部門/役割ごとに作成。

3) **工程を追加する（手動 or CSV）（4分）**  
   - 「工程一覧」タブ → 「新しい工程を追加」で1件作成し、入力項目を把握。  
   - まとめて入れる場合: 「CSVインポート」 → ヘッダー例をダウンロード → `displayId,name,lane,...` を埋めてインポート。

4) **前後関係をつける（1分）**  
   - 編集モードで「前工程」を選択。並列可のチェックで同ランク並べ替えが容易に。

5) **BPMNを確認/更新（オプション、1分）**  
   - 「BPMNエディタを開く」→ レイアウトを自動整列 → 保存。

これで最低限の工程表が完成します。

---

## よくある操作フロー

| 目的 | 画面 | 操作の流れ |
|------|------|------------|
| 新規プロジェクトを用意 | ホーム → プロジェクト | 「新規プロジェクト」→ 名前入力 → 作成 |
| スイムレーンを登録 | プロジェクト詳細 → スイムレーン | 「追加」→ 部門/役割名入力 → 保存 |
| 工程を1件追加 | プロジェクト詳細 → 工程一覧 | 「新しい工程を追加」→ 必須: 工程名, スイムレーン。必要なら工数/スキル/前工程も設定 |
| CSVで一括登録 | プロジェクト詳細 → 工程一覧 | 「CSVインポート」→ サンプルヘッダーに従い入力 → インポート。`beforeDisplayIds` は displayId で指定 |
| CSVを出力 | プロジェクト詳細 → 工程一覧 | 「CSVエクスポート」→ 文字コード選択（UTF-8推奨）→ 保存 |
| BPMNを自動レイアウト | プロジェクト詳細 → BPMNエディタ | 要素配置後に自動整列 → 保存。水平並びは直線接続、段差があれば折れ曲がりで回避 |
| マニュアル自動生成 | プロジェクト詳細 → マニュアル | 「プロセスから生成」→ オプション確認 → 生成 |
| 同期で一括更新 | プロジェクト詳細 → 三位一体同期 | 「Full Sync」または方向別同期を選択。Auto Sync を ON にすると編集後に自動反映 |

### ショートカットキー

- `Ctrl/Cmd + N`: 新規プロジェクト
- `Ctrl/Cmd + S`: 保存
- `Ctrl/Cmd + F`: 検索
- `Ctrl/Cmd + Z` / `Y`: 元に戻す / やり直す（BPMNエディタ）

---

## 画面と用語

- **プロジェクト詳細**: スイムレーン／工程／BPMN／カスタム列／データオブジェクト／同期をまとめて操作するメイン画面。
- **スイムレーン**: 部門・担当などのレーン。工程は必ずどれか1つのレーンに属します。
- **工程**: 実際の作業単位。`displayId` で並び順と参照を管理します。
- **カスタム列**: プロジェクト固有の追加項目。CSVでも入出力されます。
- **三位一体同期**: BPMN ↔ 工程 ↔ マニュアルを連携する仕組み。

---

## プロジェクト管理

### プロジェクトの作成

1. サイドバーから **📁 プロジェクト** をクリック
2. 右上の **新規プロジェクト** ボタンをクリック
3. プロジェクト情報を入力
   - **プロジェクト名** (必須): わかりやすい名前を付けます
   - **説明**: プロジェクトの概要や目的を記述
4. **作成** ボタンをクリック

### プロジェクトの編集

1. プロジェクト一覧からプロジェクトをクリック
2. プロジェクト詳細画面で **編集** ボタンをクリック
3. 情報を修正
4. **保存** をクリック

### プロジェクトの削除

1. プロジェクト一覧でプロジェクトの **...** メニューをクリック
2. **削除** を選択
3. 確認ダイアログで **削除** をクリック

⚠️ **警告**: 削除すると、すべての工程、BPMN、マニュアルも削除されます。

---

## 工程管理（CSV/手動）

### 必須と推奨項目
- 必須: `name`, `lane`（スイムレーン）, `displayId`（未指定時は自動採番）
- 推奨: `beforeDisplayIds`（前工程）, `workHours`, `skillLevel`, `systemName`, `taskType`/`gatewayType`/`eventType`, `parallelAllowed`
- 調査系: `issueDetail`, `issueCategory`, `countermeasurePolicy`, `issueWorkHours`, `timeReductionHours`, `rateReductionPercent`
- 関連: `inputDataObjects`, `outputDataObjects`, `conditionalFlows`(JSON), `messageFlows`(JSON), `artifacts`(JSON), `customColumns`

### CSVインポート手順
1. 「CSVインポート」ボタン → 既存エクスポートをサンプルとして利用。
2. 主要ヘッダー例:
   - `displayId,name,lane,bpmnElement,taskType,gatewayType,eventType,intermediateEventType,parallelAllowed,beforeDisplayIds,nextDisplayIds,parentDisplayId,workHours,workUnitPref,skillLevel,systemName,issueDetail,issueCategory,countermeasurePolicy,issueWorkHours,timeReductionHours,rateReductionPercent,eventDetails,inputDataObjects,outputDataObjects,conditionalFlows,messageFlows,artifacts,documentation,custom...`
3. `beforeDisplayIds`/`nextDisplayIds` は displayId で指定（カンマ区切り）。
4. `conditionalFlows`/`messageFlows`/`artifacts` は JSON 配列で指定例:
   ```json
   [{"targetDisplayId":2,"condition":"Aなら"}]
   ```
5. データオブジェクトは「名前」で指定し、存在しない場合は警告が出ます。
6. インポート後、未解決の参照はトーストで警告。必要なら CSV を直して再インポート。

### CSVエクスポート
- 工程一覧 → 「CSVエクスポート」。UTF-8推奨。すべての工程フィールドとカスタム列を出力。
- `workHours` は内部 `workSeconds` を時間に直した値。`displayId` と `parentDisplayId` で参照関係を保持。

### 手動入力のポイント
- 工程作成時に「前工程」を設定すると並び順が自動調整されます。
- 「並列可」にすると同ランクで縦並びになります。
- カスタム列はプロジェクト単位で定義し、工程入力時に値を設定できます。

---

## 階層管理と詳細表

### 階層表示モード

階層管理画面では2つの表示モードがあります:

1. **ツリービュー**: 階層構造をツリー形式で表示
2. **テーブルビュー**: 階層構造を表形式で表示

### 詳細表機能（Phase 8 NEW!）

各工程に対して、さらに詳細な工程を管理するための「詳細表」を作成できます。

#### 詳細表の作成

1. 階層管理画面で工程を選択
2. **詳細表作成** ボタン（緑色のフォルダープラスアイコン）をクリック
3. 詳細表が作成され、URLが `?detail=root_...` に変わります
4. パンくずリストに「詳細表」が表示されます

#### 詳細表の表示

1. 詳細表を持つ工程には **詳細表** ボタン（紫色のフォルダーアイコン）が表示されます
2. このボタンをクリックすると詳細表を開きます

#### 上位工程に戻る

1. 詳細表表示中は、ヘッダーに **上位工程に戻る** ボタンが表示されます
2. このボタンをクリックすると通常の階層表示に戻ります

💡 **ヒント**: 詳細表は4段階まで（大工程→中工程→小工程→詳細工程）。上位階層の1工程に対して下位工程表は0または1つです。

### ドラッグ&ドロップ

1. 工程をドラッグ
2. 目的の親工程にドロップ
3. 階層関係が自動的に更新されます

---

## BPMNダイアグラム

### BPMNエディタの起動

1. プロジェクト詳細画面で **BPMNエディタを開く** をクリック
2. bpmn-jsエディタが開きます

### 要素の配置

左側のパレットから要素をドラッグ&ドロップ:

- **📍 開始イベント**: プロセスの開始点
- **📝 タスク**: 作業単位
- **🔀 ゲートウェイ**: 分岐・結合
- **🏁 終了イベント**: プロセスの終了点
- **➡️ シーケンスフロー**: 要素間の接続

### 要素の編集

1. 要素をクリックして選択
2. 右側のプロパティパネルで情報を編集
3. 要素名をダブルクリックで直接編集

### BPMNショートカット

- **Ctrl/Cmd + Z**: 元に戻す
- **Ctrl/Cmd + Y**: やり直す
- **スペース + ドラッグ**: キャンバス移動
- **Ctrl/Cmd + マウスホイール**: ズーム

### レイアウトのコツ
- 同一レーンで水平に並ぶ要素は直線で接続されます。上下段差があると折れ曲がりで回避します。
- 並列工程は「並列可」をONにすると同じランクに配置されます。
- ゲートウェイ分岐は前工程の `beforeProcessIds` を揃えると整列しやすくなります。
- **Ctrl/Cmd + マウスホイール**: ズーム
- **スペース + ドラッグ**: キャンバス移動
- **Delete**: 選択した要素を削除

---

## マニュアル管理

### マニュアルの作成

#### 方法1: 工程から自動生成

1. プロジェクト詳細画面で **マニュアル** をクリック
2. **プロセスから生成** ボタンをクリック
3. 生成オプションを確認:
   - セクション構造
   - 含める情報
4. **生成** をクリック

#### 方法2: 手動作成

1. マニュアル画面で **新規セクション** をクリック
2. セクション名を入力
3. Markdownでコンテンツを記述

### マニュアルの編集

- **左側パネル**: セクションツリー（ドラッグ&ドロップで並び替え可能）
- **中央エディタ**: Markdown形式で編集
- **右側プレビュー**: リアルタイムプレビュー

### Markdown記法

```markdown
# 見出し1
## 見出し2
### 見出し3

**太字** *斜体*

- 箇条書き1
- 箇条書き2

1. 番号付きリスト1
2. 番号付きリスト2

[リンクテキスト](URL)

`インラインコード`

\```
コードブロック
\```
```

---

## 三位一体同期

### 三位一体同期とは

BPMN・工程表・マニュアルを自動的に連携・同期する機能です。

### 同期ダッシュボード

1. プロジェクト詳細画面の紫色のバナー **三位一体同期ダッシュボード** をクリック
2. 現在の同期状態を確認

### 同期機能

| 同期方向 | 説明 | 使用シーン |
|---------|------|-----------|
| **BPMN → Process** | BPMNのタスクを工程に変換 | BPMNを先に作成した場合 |
| **Process → BPMN** | 工程からBPMNを生成 | 工程表を先に作成した場合 |
| **Process → Manual** | 工程からマニュアルを生成 | マニュアルを自動作成したい場合 |
| **Full Sync** | 3つすべてを一括同期 | 全体を同期したい場合 |

### 自動同期

1. 三位一体ダッシュボードで **Auto Sync** トグルをONにする
2. BPMNを編集すると自動的に工程表とマニュアルが更新されます

⚠️ **注意**: 自動同期は既存データを上書きする可能性があります。

---

## カスタム列機能

### 概要

カスタム列機能を使用すると、プロジェクトの要件に応じて工程表に独自の列を追加できます。各プロジェクトは最大30個のカスタム列を持つことができます。

### 使用例

**製造業プロジェクト**
- 予算（数値）
- 使用設備（選択肢）
- 品質基準（テキスト）
- 安全確認完了（真偽値）

**IT開発プロジェクト**
- 見積工数（数値）
- 担当チーム（選択肢）
- 技術スタック（テキスト）
- コードレビュー完了（真偽値）

### 列の追加

1. **設定画面を開く**
   - サイドバーの「設定」アイコンをクリック
   - 「カスタム列」タブを選択

2. **新規列を作成**
   - 「+ 列を追加」ボタンをクリック
   - 列名を入力（例: "予算"）
   - データ型を選択

### データ型

| データ型 | 説明 | 入力例 |
|---------|------|--------|
| テキスト | 自由記述 | "マーケティング資料" |
| 数値 | 整数・小数 | 1000000, 12.5 |
| 日付 | 日付選択 | 2025-10-19 |
| 選択肢 | プルダウン | "高", "中", "低" |
| 真偽値 | チェックボックス | ✓ / ✗ |

### オプション設定

- **必須入力**: ONにすると入力が必須
- **デフォルト値**: 新規工程作成時の初期値
- **表示**: OFFにすると表に表示されない

### 列の編集・削除

1. 列名をクリックして編集モードに
2. 設定を変更して **保存**
3. 削除する場合は **...** メニュー → **削除**

⚠️ **警告**: 列を削除すると、すべての工程のその列のデータも削除されます。

---

## インポート・エクスポート

### Excelインポート

1. **Excelインポート** ボタンをクリック
2. **テンプレートをダウンロード** で雛形を取得
3. Excelファイルに工程データを入力
4. **ファイルを選択** でExcelファイルを選択
5. **インポート** をクリック

### Excelエクスポート

1. **Excelエクスポート** ボタンをクリック
2. エクスポートオプションを選択:
   - 含める列
   - 階層表示
3. **エクスポート** をクリック
4. ファイルの保存先を選択

### CSV形式

CSVファイルでもインポート・エクスポート可能です。

---

## トラブルシューティング

- **CSVインポートで前工程が紐付かない**: `beforeDisplayIds` が存在しない displayId を指している場合は警告が出ます。CSVを修正して再インポートしてください。
- **文字化けする**: 文字コードは UTF-8 を推奨。Shift-JIS で開いたときに化けた場合は UTF-8 で再保存してください。
- **BPMNの線が曲がる**: 同一レーンで高さが揃っていれば直線になります。上下に段差があると折れ曲がりで回避します。
- **データオブジェクトが反映されない**: CSVではデータオブジェクト名で指定します。存在しない名前は警告されます。事前にデータオブジェクトを登録してください。
- **自動同期で上書きが心配**: Auto Sync をOFFにし、方向別同期（BPMN→工程など）を必要なときだけ実行してください。

---

## サポート

問題が解決しない場合は、以下を参照してください:

- **ドキュメント**: `docs/` フォルダ内のドキュメント
- **GitHub Issues**: バグ報告や機能要望
- **開発者ガイド**: `docs/DEVELOPMENT.md`

---

**最終更新**: 2025年12月18日  
**バージョン**: 2.0.0
